#!/usr/bin/python
#
# Produce example JSON to be POSTed to API backend
#
# $ ./example-json | curl --data-urlencode request@- -v localhost:8511/mfa_add
#
#

import sys
import json
import jose
import time

with open('example-server-cert.pem') as fd:
    jwk = {'k': fd.read(),
           }

with open('example.key') as fd:
    priv_jwk = {'k': fd.read(),
                }

claims = {'foo': 'bar',
          'version': 1,
          'data': {},
          }

sys.stderr.write(json.dumps(claims, sort_keys=True, indent=4) + '\n')

jws = jose.sign(claims, priv_jwk, alg='RS256')
sys.stderr.write("JWS before serialization:\n{!r}\n\n".format(jws))
signed_claims = {'v1': jose.serialize_compact(jws)}
sys.stderr.write("Signed claims:\n{!r}\n\n\n".format(signed_claims))

jwe = jose.encrypt(signed_claims, jwk)

sys.stderr.write("Encrypted using JWK:\n{!r}\n\nResulting JWE:\n{!r}\n\n".format(jwk, jwe))

print jose.serialize_compact(jwe)
